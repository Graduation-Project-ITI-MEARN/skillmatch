<div class="min-h-screen bg-linear-to-br from-gray-50 to-blue-50 py-12 px-4">
  <div class="max-w-5xl mx-auto">
    <!-- Header -->
    <button
      (click)="goBack()"
      class="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-8 transition-colors"
    >
      <lucide-icon [img]="icons.ArrowLeft" class="w-5 h-5"></lucide-icon>
      <span class="font-medium">{{ 'CHALLENGE.BACK' | translate }}</span>
    </button>

    <div *ngIf="isLoading" class="flex justify-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
    </div>

    <div *ngIf="!isLoading" class="grid grid-cols-1 lg:grid-cols-5 gap-8">
      <!-- Left Side Info -->
      <div class="lg:col-span-2">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
          {{ 'CHALLENGE.EDIT.TITLE' | translate }}
        </h1>
        <p class="text-gray-600 text-lg mb-8">{{ 'CHALLENGE.EDIT.DESCRIPTION' | translate }}</p>

        <div
          *ngIf="isRestrictedMode"
          class="mb-6 p-5 bg-amber-50 border-2 border-amber-300 rounded-xl"
        >
          <div class="flex items-start gap-3">
            <lucide-icon
              [img]="icons.AlertTriangle"
              class="w-6 h-6 text-amber-600 shrink-0"
            ></lucide-icon>
            <div>
              <h3 class="font-bold text-amber-900">Restricted Mode</h3>
              <p class="text-amber-800 text-sm">{{ restrictedReason }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side Form (Matched to Create Layout) -->
      <div class="lg:col-span-3">
        <form
          [formGroup]="challengeForm"
          (ngSubmit)="onSubmit()"
          class="bg-white rounded-2xl shadow-xl p-8 space-y-6"
        >
          <!-- Title -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.TITLE' | translate }} *</label
            >
            <input
              type="text"
              formControlName="title"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg outline-none focus:border-gray-900"
            />
          </div>

          <!-- Category & Difficulty -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >{{ 'CHALLENGE.FORM.CATEGORY' | translate }} *</label
              >
              <div class="relative">
                <button
                  type="button"
                  (click)="!isRestrictedMode && (openCategory = !openCategory)"
                  class="flex items-center justify-between w-full px-4 py-3 border border-gray-300 rounded-lg bg-white"
                >
                  <span>{{
                    selectedCategory || ('CHALLENGE.FORM.SELECT_CATEGORY' | translate)
                  }}</span>
                  <lucide-icon
                    [img]="icons.ChevronDown"
                    class="w-5 h-5 text-gray-500"
                  ></lucide-icon>
                </button>
                <ul
                  *ngIf="openCategory"
                  class="absolute z-20 mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-xl"
                >
                  <li
                    *ngFor="let cat of categories"
                    (click)="selectCategory(cat)"
                    class="px-4 py-2 hover:bg-gray-50 cursor-pointer"
                  >
                    {{ cat }}
                  </li>
                </ul>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >{{ 'CHALLENGE.FORM.DIFFICULTY' | translate }} *</label
              >
              <div class="relative">
                <button
                  type="button"
                  (click)="!isRestrictedMode && (openDifficulty = !openDifficulty)"
                  class="flex items-center justify-between w-full px-4 py-3 border border-gray-300 rounded-lg bg-white"
                >
                  <span>{{
                    selectedDifficulty || ('CHALLENGE.FORM.SELECT_DIFFICULTY' | translate)
                  }}</span>
                  <lucide-icon
                    [img]="icons.ChevronDown"
                    class="w-5 h-5 text-gray-500"
                  ></lucide-icon>
                </button>
                <ul
                  *ngIf="openDifficulty"
                  class="absolute z-20 mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-xl"
                >
                  <li
                    *ngFor="let level of difficultyLevels"
                    (click)="selectDifficulty(level)"
                    class="px-4 py-2 hover:bg-gray-50 cursor-pointer"
                  >
                    {{ level }}
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Deadline (Zard UI) -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.DEADLINE' | translate }} *</label
            >
            <z-calendar
              [minDate]="minDate"
              [value]="challengeForm.get('deadline')?.value"
              (dateChange)="challengeForm.get('deadline')?.setValue($event)"
            ></z-calendar>
          </div>

          <!-- Salary -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.SALARY' | translate }} *</label
            >
            <input
              type="number"
              formControlName="salary"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg"
            />
          </div>

          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.DESCRIPTION' | translate }} *</label
            >
            <textarea
              formControlName="description"
              rows="4"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg"
            ></textarea>
          </div>

          <!-- Requirements -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.REQUIREMENTS' | translate }} *</label
            >
            <textarea
              formControlName="requirements"
              rows="4"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg"
            ></textarea>
          </div>

          <!-- Evaluation Criteria -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.EVALUATION_CRITERIA' | translate }} *</label
            >
            <textarea
              formControlName="evaluationCriteria"
              rows="4"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg"
            ></textarea>
          </div>

          <!-- Deliverables -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >{{ 'CHALLENGE.FORM.DELIVERABLES' | translate }} *</label
            >
            <textarea
              formControlName="deliverables"
              rows="4"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg"
            ></textarea>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            [disabled]="isSubmitting"
            class="w-full px-6 py-4 bg-gray-900 text-white rounded-xl font-semibold hover:bg-gray-800 shadow-lg text-lg"
          >
            <span *ngIf="!isSubmitting">{{ 'CHALLENGE.FORM.UPDATE' | translate }}</span>
            <span *ngIf="isSubmitting">{{ 'CHALLENGE.FORM.UPDATING' | translate }}</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
