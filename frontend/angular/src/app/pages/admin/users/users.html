<div class="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
  <!-- Header & Filters -->
  <!-- ID added for scroll-to-top functionality -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4" id="user-list-top">
    <div>
      <h2 class="text-2xl font-bold mb-2 text-gray-900">
        {{ 'DASHBOARD.ADMIN.USERS.TITLE' | translate }}
      </h2>
      <p class="text-gray-600">{{ 'DASHBOARD.ADMIN.USERS.SUBTITLE' | translate }}</p>
    </div>

    <!-- Filter Buttons -->
    <div class="flex flex-wrap gap-2">
      @for(tab of tabs; track tab) {
      <button
        (click)="setTab(tab)"
        class="px-4 py-2 rounded-md transition-all font-medium text-sm"
        [ngClass]="{
          'bg-gray-900 text-white': currentTab() === tab,
          'bg-white border border-gray-200 text-gray-700 hover:bg-gray-50': currentTab() !== tab
        }"
      >
        {{ tab | translate }}
      </button>
      }
    </div>
  </div>

  <!-- Users List Container -->
  <div class="space-y-3 min-h-100">
    @if (loading()) {
    <div class="p-12 text-center text-gray-500">
      {{ 'DASHBOARD.GENERAL.LOADING' | translate }}
    </div>
    } @else {

    <!-- Empty State Check -->
    @if (allUsers().length === 0) {
    <div
      class="p-12 text-center text-gray-500 bg-white rounded-md border border-dashed border-gray-200"
    >
      <p>{{ 'DASHBOARD.ADMIN.USERS.NO_USERS' | translate }}</p>
    </div>
    } @else {

    <!-- Loop over PAGINATED users -->
    @for (user of paginatedUsers(); track user._id) {
    <ui-card class="mb-4">
      <div class="flex flex-col lg:flex-row lg:items-center gap-6">
        <!-- Avatar -->
        <div
          class="w-12 h-12 rounded-full bg-primary-gradient flex items-center justify-center text-white font-bold shrink-0"
        >
          {{ getInitials(user.name) }}
        </div>

        <!-- Info Section -->
        <div class="flex-1">
          <div class="flex flex-wrap items-center gap-3 mb-1">
            <h3 class="text-lg font-semibold text-gray-900">{{ user.name }}</h3>

            <!-- Role Badge -->
            <span
              class="px-3 py-1 bg-gray-100 rounded-full text-xs font-medium text-gray-600 capitalize"
            >
              {{ user.type || user.role }}
            </span>

            <!-- Status Badge -->
            <span
              class="px-3 py-1 rounded-full text-xs font-medium"
              [ngClass]="{
                'bg-green-100 text-green-700': user.isVerified,
                'bg-yellow-100 text-yellow-700': !user.isVerified
              }"
            >
              {{ user.isVerified ? 'Verified' : 'Pending' }}
            </span>
          </div>

          <!-- Conditional: Extra info for Pending Users -->
          @if (!user.isVerified) {
          <div class="mt-2 flex items-center gap-2 text-xs text-gray-600 animate-in fade-in">
            @if (user.type === 'company') {
            <lucide-icon [img]="icons.CreditCard" class="w-3 h-3"></lucide-icon>
            <span>Tax Card: Requires Review</span>
            } @else {
            <lucide-icon [img]="icons.FileText" class="w-3 h-3"></lucide-icon>
            <span>ID: Requires Review</span>
            }
          </div>
          }
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-2 mt-4 lg:mt-0">
          <button
            (click)="onView(user)"
            class="px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-all text-sm flex items-center gap-2"
          >
            <lucide-icon [img]="icons.Eye" class="w-4 h-4"></lucide-icon>
            {{
              user.type === 'company'
                ? ('DASHBOARD.ADMIN.USERS.VIEW_TAX' | translate)
                : ('DASHBOARD.ADMIN.USERS.VIEW_ID' | translate)
            }}
          </button>

          <!-- Verify/Reject only if Pending -->
          @if (!user.isVerified) {
          <button
            (click)="onVerify(user)"
            class="px-4 py-2 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-all text-sm flex items-center gap-2"
          >
            <lucide-icon [img]="icons.CheckCircle" class="w-4 h-4"></lucide-icon>
            {{ 'DASHBOARD.ADMIN.USERS.VERIFY' | translate }}
          </button>
          <button
            (click)="onReject(user)"
            class="px-4 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-all text-sm flex items-center gap-2"
          >
            <lucide-icon [img]="icons.XCircle" class="w-4 h-4"></lucide-icon>
            {{ 'DASHBOARD.ADMIN.USERS.REJECT' | translate }}
          </button>
          }
        </div>
      </div>
    </ui-card>
    } } }
  </div>

  <!-- Pagination Footer -->
  @if (!loading() && allUsers().length > 0) {
  <div class="flex items-center justify-between border-t border-gray-200 pt-4 mt-4">
    <span class="text-sm text-gray-500">
      {{ 'DASHBOARD.GENERAL.SHOWING' | translate }}
      {{ (currentPage() - 1) * itemsPerPage + 1 }} -
      {{
        currentPage() * itemsPerPage > allUsers().length
          ? allUsers().length
          : currentPage() * itemsPerPage
      }}
      {{ 'DASHBOARD.GENERAL.OF' | translate }}
      {{ allUsers().length }}
    </span>

    <div class="flex gap-2">
      <button
        (click)="prevPage()"
        [disabled]="currentPage() === 1"
        class="flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm text-gray-600"
      >
        <lucide-icon [img]="icons.ChevronLeft" class="w-4 h-4"></lucide-icon>
        {{ 'DASHBOARD.GENERAL.PREVIOUS' | translate }}
      </button>

      <button
        (click)="nextPage()"
        [disabled]="currentPage() >= totalPages()"
        class="flex items-center gap-1 px-3 py-1.5 rounded-md border border-gray-200 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm text-gray-600"
      >
        {{ 'DASHBOARD.GENERAL.NEXT' | translate }}
        <lucide-icon [img]="icons.ChevronRight" class="w-4 h-4"></lucide-icon>
      </button>
    </div>
  </div>
  }
</div>
