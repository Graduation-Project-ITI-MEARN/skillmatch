<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 fade-in">
  <!-- LEFT COLUMN: Active Applications -->
  <div class="col-span-1 lg:col-span-2 space-y-4">
    <!-- Header & Sorting -->
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">
        {{ 'DASHBOARD.SECTION.ACTIVE_APPLICATIONS' | translate }}
      </h2>

      <!-- Sorting Dropdown -->
      <div class="relative">
        <select
          [(ngModel)]="sortOption"
          (change)="sortChallenges()"
          class="appearance-none pl-4 pr-10 py-2 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all cursor-pointer shadow-sm text-gray-700"
        >
          <option value="date_desc">{{ 'SORT.NEWEST' | translate }}</option>
          <option value="date_asc">{{ 'SORT.OLDEST' | translate }}</option>
        </select>
        <!-- Icon -->
        <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">
          <lucide-icon [img]="icons.Filter" class="w-3 h-3"></lucide-icon>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-12">
      <div
        class="animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"
      ></div>
      <p class="text-gray-500 mt-3 text-sm">Loading dashboard...</p>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="!isLoading && activeChallenges.length === 0"
      class="p-8 text-center bg-gray-50 rounded-2xl border border-dashed border-gray-300"
    >
      <p class="text-gray-500 mb-2">{{ 'NO_DATA' | translate }}</p>
      <button class="btn btn-sm btn-outline-primary">Browse Challenges</button>
    </div>

    <!-- Challenge Cards Loop -->
    @for (challenge of activeChallenges; track challenge._id) {
    <div
      class="relative bg-white rounded-2xl p-6 group hover:bg-gray-50 transition-all cursor-pointer border border-gray-200 hover:border-primary/30 shadow-sm hover:shadow-md"
    >
      <!-- Top Row -->
      <div class="flex items-start justify-between mb-4">
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-2 flex-wrap">
            <h3 class="text-lg font-bold text-gray-900 group-hover:text-primary transition-colors">
              {{ challenge.title }}
            </h3>

            <!-- Category Badge -->
            <span
              class="px-2.5 py-0.5 bg-gray-100 rounded-full text-xs font-semibold text-gray-600 border border-gray-200"
            >
              {{ challenge.category }}
            </span>

            <!-- Level Badge -->
            <span
              class="px-2.5 py-0.5 rounded-full text-xs font-semibold border border-transparent"
              [ngClass]="challenge.levelColor"
            >
              {{ challenge.level || 'Intermediate' }}
            </span>
          </div>

          <p class="text-sm text-gray-500 font-medium">
            {{ challenge.company || 'Unknown Company' }}
          </p>
        </div>

        <!-- Prize Display -->
        <div class="text-right pl-4" *ngIf="challenge.prize">
          <div class="text-xl font-bold text-gray-900 leading-none mb-1">
            {{ challenge.prize | currency }}
          </div>
          <div class="text-[10px] text-gray-500 uppercase tracking-wider font-semibold">
            {{ 'STATS.PRIZE' | translate }}
          </div>
        </div>
      </div>

      <!-- Meta Info Row -->
      <div class="flex items-center gap-6 mb-5 text-sm text-gray-500 font-medium">
        <div
          class="flex items-center gap-1.5"
          [ngClass]="{ 'text-red-600': challenge.daysLeft < 3 }"
        >
          <lucide-icon [img]="icons.Clock" class="w-4 h-4"></lucide-icon>
          {{ challenge.daysLeft }} {{ 'TIME.DAYS_LEFT' | translate }}
        </div>
        <div class="flex items-center gap-1.5">
          <lucide-icon [img]="icons.Trophy" class="w-4 h-4"></lucide-icon>
          {{ challenge.competitors }} {{ 'STATS.COMPETING' | translate }}
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="flex items-center justify-between pt-4 border-t border-gray-100">
        <div class="flex gap-2">
          <!-- Optional Tag -->
          <span
            *ngIf="challenge.tags?.[0]"
            class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded"
          >
            #{{ challenge.tags[0] }}
          </span>
        </div>

        <button
          class="flex items-center gap-2 px-5 py-2 bg-gray-900 text-white rounded-lg hover:bg-black transition-all font-medium text-sm shadow-lg shadow-gray-900/10 group-hover:shadow-gray-900/20"
        >
          {{ 'BTN.CONTINUE' | translate }}
          <lucide-icon
            [img]="icons.ChevronRight"
            class="w-4 h-4 transition-transform group-hover:translate-x-1 rtl:group-hover:-translate-x-1"
          ></lucide-icon>
        </button>
      </div>
    </div>
    }
  </div>

  <!-- RIGHT COLUMN: Sidebar (AI & Activity) -->
  <div class="col-span-1 space-y-6">
    <!-- 1. AI Recommendations -->
    <div
      class="bg-gradient-to-bottom from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100 relative overflow-hidden"
    >
      <!-- Decorative background blur -->
      <div
        class="absolute top-0 right-0 w-24 h-24 bg-blue-400/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"
      ></div>

      <div class="flex items-center gap-2 mb-4 text-blue-900 relative z-10">
        <lucide-icon [img]="icons.Brain" class="w-5 h-5"></lucide-icon>
        <h3 class="text-base font-bold">{{ 'SECTION.AI_RECOMMENDATIONS' | translate }}</h3>
      </div>

      @if (aiRecommendations.length > 0) { @for (rec of aiRecommendations.slice(0, 1); track rec) {
      <div class="relative z-10">
        <p class="text-sm text-gray-700 mb-4 leading-relaxed">
          {{ rec.reason || 'Based on your recent performance, you are a strong match for:' }}
          <br />
          <strong class="text-gray-900 block mt-2 text-base">{{ rec.role }}</strong>
          <span class="text-gray-600 text-xs">at {{ rec.company }}</span>
        </p>
        <button
          class="w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium shadow-md shadow-blue-600/20"
        >
          {{ 'BTN.VIEW_MATCH' | translate }}
        </button>
      </div>
      } } @else {
      <p class="text-sm text-gray-500 italic relative z-10">{{ 'AI.ANALYZING' | translate }}...</p>
      }
    </div>

    <!-- 2. Recent Activity -->
    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center gap-2 mb-5">
        <lucide-icon [img]="icons.Activity" class="w-5 h-5 text-gray-400"></lucide-icon>
        <h3 class="text-base font-bold text-gray-900">
          {{ 'SECTION.RECENT_ACTIVITY' | translate }}
        </h3>
      </div>

      <div class="space-y-4">
        @if (recentActivities.length > 0) { @for (act of recentActivities; track act._id) {
        <div class="flex gap-3 group">
          <!-- Timeline line -->
          <div class="relative flex flex-col items-center">
            <div
              class="w-2 h-2 rounded-full bg-gray-300 group-hover:bg-primary transition-colors"
            ></div>
            <div class="w-px h-full bg-gray-100 my-1 last:hidden"></div>
          </div>

          <div class="pb-2">
            <p class="text-sm font-medium text-gray-800 leading-tight">
              {{ act.description }}
            </p>
            <div class="flex items-center gap-1.5 mt-1 text-xs text-gray-400">
              <lucide-icon [img]="icons.Calendar" class="w-3 h-3"></lucide-icon>
              {{ act.timestamp | date : 'MMM d, h:mm a' }}
            </div>
          </div>
        </div>
        } } @else {
        <p class="text-sm text-gray-400 pl-2">{{ 'NO_DATA' | translate }}</p>
        }
      </div>
    </div>
  </div>
</div>
