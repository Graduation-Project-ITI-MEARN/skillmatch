<div class="animate-fade-in">
  @if (isLoading) {
  <div class="flex justify-center items-center h-64">
    <div
      class="animate-spin w-8 h-8 border-4 border-gray-900 border-t-transparent rounded-full"
    ></div>
  </div>
  } @else {

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- LEFT COLUMN: Available Challenges (Dynamic) -->
    <div class="col-span-1 lg:col-span-2 space-y-4">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Available Challenges</h2>
        <div class="flex gap-2">
          <!-- Filters (Mock) -->
          <button
            class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50 transition-all text-gray-700 font-medium"
          >
            All Fields
          </button>
          <button
            class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50 transition-all text-gray-700 font-medium"
          >
            Filters
          </button>
        </div>
      </div>

      <!-- Empty State -->
      @if (activeChallenges.length === 0) {
      <div class="p-10 text-center bg-gray-50 rounded-2xl border border-dashed border-gray-300">
        <p class="text-gray-500">No active challenges found.</p>
      </div>
      }

      <!-- Loop: Challenge Cards -->
      @for (challenge of activeChallenges; track challenge._id) {
      <div
        class="relative bg-white rounded-2xl p-6 group hover:bg-gray-50 transition-all cursor-pointer border border-gray-200 hover:border-gray-300 shadow-sm hover:shadow-md"
      >
        <!-- Top Row: Title, Tags, Prize -->
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2 flex-wrap">
              <h3
                class="text-xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors"
              >
                {{ challenge.title }}
              </h3>

              <!-- Category -->
              <span class="px-3 py-1 bg-gray-100 rounded-full text-xs font-semibold text-gray-600">
                {{ challenge.category }}
              </span>

              <!-- Difficulty (Colored) -->
              <span
                class="px-3 py-1 rounded-full text-xs font-semibold"
                [ngClass]="challenge.levelColor"
              >
                {{ challenge.difficulty || 'Intermediate' }}
              </span>
            </div>
            <p class="text-sm text-gray-600 font-medium">
              {{ challenge.company || 'TechCorp Inc.' }}
            </p>
          </div>

          <!-- Prize -->
          <div class="text-right pl-4">
            <div class="text-2xl font-bold text-gray-900 mb-1">${{ challenge.prize }}</div>
            <div class="text-xs text-gray-500 uppercase font-semibold">Prize</div>
          </div>
        </div>

        <!-- Meta Info: Time, Competitors -->
        <div class="flex items-center gap-6 mb-4 text-sm text-gray-600 font-medium">
          <div class="flex items-center gap-2" [class.text-red-600]="challenge.daysLeft < 3">
            <lucide-icon [img]="icons.Clock" class="w-4 h-4"></lucide-icon>
            {{ challenge.daysLeft }} days left
          </div>
          <div class="flex items-center gap-2">
            <lucide-icon [img]="icons.Trophy" class="w-4 h-4"></lucide-icon>
            {{ challenge.competitors }} competing
          </div>
        </div>

        <!-- Bottom Row: Stack & Action -->
        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
          <div class="flex gap-2">
            <!-- Mock Tech Stack -->
            @for (tech of challenge.techStack; track $index) {
            <span
              class="px-3 py-1 bg-gray-100 rounded-lg text-xs font-medium text-gray-600 border border-gray-200"
            >
              {{ tech }}
            </span>
            }
          </div>

          <button
            class="flex items-center gap-2 px-5 py-2 bg-gray-900 text-white rounded-lg hover:bg-black transition-all font-medium text-sm shadow-lg shadow-gray-900/10"
          >
            Start Challenge
            <lucide-icon [img]="icons.ChevronRight" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
      </div>
      }
    </div>

    <!-- RIGHT COLUMN: Sidebar (AI, Submissions, Stats) -->
    <div class="space-y-6 col-span-1">
      <!-- 1. AI Recommendations -->
      <div
        class="absolute top-0 right-0 w-24 h-24 bg-blue-400/10 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none"
      ></div>

      <div class="flex items-center gap-2 mb-4 text-blue-900 relative z-10">
        <lucide-icon [img]="icons.Brain" class="w-5 h-5"></lucide-icon>
        <h3 class="text-base font-bold">
          {{ 'DASHBOARD.SECTION.AI_RECOMMENDATIONS' | translate }}
        </h3>
      </div>

        @if (aiRecommendations.length > 0) {
        <p class="text-sm text-gray-700 mb-4 leading-relaxed">
          Based on your skills, we recommend starting with the
          <strong class="text-gray-900">{{ aiRecommendations[0].role || 'Next Challenge' }}</strong
          >. It matches <span class="font-bold text-blue-600">94%</span> with your expertise.
        </p>
        <button
          class="w-full px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-all text-sm font-medium shadow-md"
        >
          View Match Details
        </button>
        } @else {
        <p class="text-sm text-gray-600 italic">Analyzing your profile for recommendations...</p>
        }
      </div>

    <!-- 2. Recent Activity -->
    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
      <div class="flex items-center gap-2 mb-5">
        <lucide-icon [img]="icons.Activity" class="w-5 h-5 text-gray-400"></lucide-icon>
        <h3 class="text-base font-bold text-gray-900">
          {{ 'DASHBOARD.SECTION.RECENT_ACTIVITY' | translate }}
        </h3>
      </div>

        <div class="space-y-3">
          @if (recentSubmissions.length === 0) {
          <p class="text-sm text-gray-400 italic">No submissions yet.</p>
          } @for (sub of recentSubmissions; track sub._id) {
          <div
            class="p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-all cursor-pointer group border border-gray-100"
          >
            <div class="flex items-start justify-between mb-2">
              <div class="flex-1">
                <h4
                  class="text-sm font-bold text-gray-900 mb-1 line-clamp-1"
                  [title]="sub.challengeId?.title"
                >
                  {{ sub.challengeId?.title || 'Unknown Challenge' }}
                </h4>
                <p class="text-xs text-gray-500 font-medium">
                  {{ sub.aiScore ? 'Evaluated' : 'Under Review' }}
                </p>
              </div>

              @if (sub.aiScore) {
              <span
                class="px-2 py-1 bg-gradient-to-right from-blue-400 to-purple-400 text-white rounded-lg text-[10px] font-bold"
              >
                Score: {{ sub.aiScore }}
              </span>
              }
            </div>

            <!-- Score Bar -->
            @if (sub.aiScore) {
            <div class="flex items-center gap-2">
              <div class="flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div
                  class="h-full bg-gradient-to-right from-blue-400 to-purple-400 rounded-full"
                  [style.width.%]="sub.aiScore"
                ></div>
              </div>
              <span class="text-xs font-bold text-gray-600">{{ sub.aiScore }}</span>
            </div>
            }
          </div>
          }
        </div>
      </div>

      <!-- 3. This Week Stats (Mock/Calculated) -->
      <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
        <h3 class="text-lg font-bold mb-4 text-gray-800">This Week</h3>
        <div class="space-y-4">
          <div
            class="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg transition-colors"
          >
            <span class="text-sm text-gray-600 font-medium">Challenges Started</span>
            <span class="text-xl font-bold text-gray-900">{{ weeklyStats.started }}</span>
          </div>
          <div
            class="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg transition-colors"
          >
            <span class="text-sm text-gray-600 font-medium">Videos Recorded</span>
            <span class="text-xl font-bold text-gray-900">{{ weeklyStats.videos }}</span>
          </div>
          <div
            class="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg transition-colors"
          >
            <span class="text-sm text-gray-600 font-medium">Avg. Score</span>
            <span class="text-xl font-bold text-blue-600">{{ weeklyStats.avgScore }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>
