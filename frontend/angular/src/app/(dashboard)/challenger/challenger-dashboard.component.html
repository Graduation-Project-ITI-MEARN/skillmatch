<!-- WRAPPER CONTAINER -->
<div class="min-h-screen bg-slate-50 p-4 lg:p-8 font-sans text-slate-900">
  <!-- HEADER SECTION -->
  <header
    class="relative bg-slate-900 rounded-3xl p-8 mb-8 overflow-hidden shadow-2xl shadow-slate-200"
  >
    <!-- Abstract Background shapes -->
    <div
      class="absolute top-0 right-0 w-96 h-96 bg-blue-600 rounded-full blur-3xl opacity-20 -mr-20 -mt-20"
    ></div>
    <div
      class="absolute bottom-0 left-0 w-72 h-72 bg-purple-600 rounded-full blur-3xl opacity-20 -ml-10 -mb-10"
    ></div>

    <div
      class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6"
    >
      <div>
        <div class="flex items-center gap-3 mb-2">
          <div
            class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm border border-white/10"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6 text-white"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
              ></path>
            </svg>
          </div>
          <h1 class="text-3xl font-bold text-white tracking-tight">Challenge Creator Hub</h1>
        </div>
        <p class="text-slate-400 text-lg font-medium max-w-xl">
          Create competitions, discover talent, and build your community.
        </p>
      </div>

      <div
        class="flex items-center gap-4 bg-white/5 p-2 rounded-full border border-white/10 backdrop-blur-md pr-6"
      >
        <img
          src="https://ui-avatars.com/api/?name=Mancy&background=3b82f6&color=fff"
          alt="User"
          class="w-10 h-10 rounded-full border-2 border-slate-900"
        />
        <div class="hidden sm:block">
          <p class="text-xs text-slate-400 font-medium uppercase tracking-wider">Logged In As</p>
          <p class="text-sm text-white font-bold">mancy@mail.com</p>
        </div>
      </div>
    </div>
  </header>

  <!-- STATS GRID -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <!-- Active Challenges -->
    <div
      class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="p-2.5 bg-blue-50 text-blue-600 rounded-xl">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
          </svg>
        </div>
        <div
          class="flex items-center text-green-600 bg-green-50 px-2 py-1 rounded-full text-xs font-bold"
        >
          <svg
            class="w-3 h-3 mr-1"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
          12%
        </div>
      </div>
      <div class="text-3xl font-extrabold text-slate-900">{{ stats.activeCount || 0 }}</div>
      <div class="text-sm text-slate-500 font-medium">Active Challenges</div>
    </div>

    <!-- Total Participants -->
    <div
      class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="p-2.5 bg-purple-50 text-purple-600 rounded-xl">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div
          class="flex items-center text-green-600 bg-green-50 px-2 py-1 rounded-full text-xs font-bold"
        >
          <svg
            class="w-3 h-3 mr-1"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
          8%
        </div>
      </div>
      <div class="text-3xl font-extrabold text-slate-900">{{ stats.totalSubmissions || 0 }}</div>
      <div class="text-sm text-slate-500 font-medium">Total Participants</div>
    </div>

    <!-- Prizes Paid -->
    <div
      class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="p-2.5 bg-emerald-50 text-emerald-600 rounded-xl">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
            <line x1="2" y1="10" x2="22" y2="10"></line>
          </svg>
        </div>
      </div>
      <div class="text-3xl font-extrabold text-slate-900">
        {{ stats.totalPrizes || 0 | currency : 'EGP ' : 'symbol' : '1.0-0' }}
      </div>
      <div class="text-sm text-slate-500 font-medium">Prizes Paid Out</div>
    </div>

    <!-- Quality Score -->
    <div
      class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60 hover:shadow-md transition-shadow"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="p-2.5 bg-orange-50 text-orange-600 rounded-xl">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polygon
              points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
            ></polygon>
          </svg>
        </div>
        <span class="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded-full"
          >Avg</span
        >
      </div>
      <div class="text-3xl font-extrabold text-slate-900">{{ stats.averageScore || 85 }}</div>
      <div class="text-sm text-slate-500 font-medium">Quality Score</div>
    </div>
  </div>

  <!-- TABS NAVIGATION -->
  <div
    class="flex items-center gap-2 mb-8 bg-white p-1.5 rounded-xl border border-slate-200 w-fit shadow-sm"
  >
    <button
      (click)="switchTab('active')"
      [class]="
        activeTab === 'active'
          ? 'bg-slate-900 text-white shadow-md'
          : 'text-slate-600 hover:bg-slate-50 hover:text-slate-900'
      "
      class="px-5 py-2.5 rounded-lg text-sm font-semibold transition-all flex items-center gap-2"
    >
      <svg
        class="w-4 h-4"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
        <polyline points="2 17 12 22 22 17"></polyline>
        <polyline points="2 12 12 17 22 12"></polyline>
      </svg>
      Active Challenges
    </button>
    <button
      (click)="switchTab('completed')"
      [class]="
        activeTab === 'completed'
          ? 'bg-slate-900 text-white shadow-md'
          : 'text-slate-600 hover:bg-slate-50 hover:text-slate-900'
      "
      class="px-5 py-2.5 rounded-lg text-sm font-semibold transition-all flex items-center gap-2"
    >
      <svg
        class="w-4 h-4"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      Completed
    </button>
    <div class="w-px h-6 bg-slate-200 mx-1"></div>
    <button
      (click)="switchTab('create')"
      [class]="
        activeTab === 'create'
          ? 'bg-blue-600 text-white shadow-md shadow-blue-200'
          : 'text-blue-600 bg-blue-50 hover:bg-blue-100'
      "
      class="px-5 py-2.5 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ml-auto"
    >
      <svg
        class="w-4 h-4"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Create Challenge
    </button>
  </div>

  <!-- MAIN CONTENT GRID -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- LEFT COLUMN (Challenge List) -->
    <div class="lg:col-span-2 space-y-6" *ngIf="activeTab !== 'create'">
      <!-- List Header -->
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-bold text-slate-800">
          {{ activeTab === 'active' ? 'Ongoing Challenges' : 'Past Challenges' }}
        </h2>
        <span class="text-xs font-semibold text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
          {{ challenges.length }} found
        </span>
      </div>

      <!-- SKELETON LOADER -->
      <div *ngIf="isLoading" class="space-y-4">
        <div
          *ngFor="let i of [1, 2, 3]"
          class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm animate-pulse"
        >
          <div class="h-6 bg-slate-100 rounded-md w-3/4 mb-3"></div>
          <div class="h-4 bg-slate-50 rounded-md w-1/2 mb-6"></div>
          <div class="flex gap-4">
            <div class="h-10 bg-slate-100 rounded-lg w-32"></div>
            <div class="h-10 bg-slate-100 rounded-lg w-32"></div>
          </div>
        </div>
      </div>

      <!-- EMPTY STATE -->
      <div
        *ngIf="!isLoading && challenges.length === 0"
        class="flex flex-col items-center justify-center py-16 bg-white rounded-3xl border border-dashed border-slate-300"
      >
        <div
          class="w-20 h-20 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            class="w-10 h-10"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
        </div>
        <h3 class="text-lg font-bold text-slate-900">No challenges found</h3>
        <p class="text-slate-500 mb-6 text-center max-w-xs">
          It looks quiet here. Start by creating a new challenge to engage the community.
        </p>
        <button
          *ngIf="activeTab === 'active'"
          (click)="switchTab('create')"
          class="text-blue-600 font-bold hover:underline"
        >
          Create your first challenge &rarr;
        </button>
      </div>

      <!-- CHALLENGE CARDS -->
      <div
        *ngFor="let challenge of challenges"
        class="group bg-white rounded-2xl p-6 border border-slate-200 hover:border-blue-400 hover:shadow-lg transition-all duration-300 animate-fade-in relative overflow-hidden"
      >
        <!-- Hover Gradient -->
        <div
          class="absolute inset-0 bg-gradient-to-r from-blue-50/50 to-purple-50/50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"
        ></div>

        <div class="relative z-10">
          <!-- Card Top -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2 mb-2">
                <span
                  class="px-2.5 py-1 bg-slate-100 text-slate-600 rounded-md text-[10px] font-bold uppercase tracking-wider"
                >
                  {{ challenge.category }}
                </span>
                <span
                  class="px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border"
                  [ngClass]="{
                    'bg-green-50 text-green-700 border-green-200': challenge.status === 'published',
                    'bg-gray-100 text-gray-500 border-gray-200': challenge.status === 'closed'
                  }"
                >
                  {{ challenge.status === 'published' ? 'Active' : 'Closed' }}
                </span>
              </div>
              <h3
                class="text-xl font-bold text-slate-900 group-hover:text-blue-600 transition-colors mb-2"
              >
                {{ challenge.title }}
              </h3>
              <p class="text-sm text-slate-500 line-clamp-2 leading-relaxed">
                {{ challenge.description }}
              </p>
            </div>

            <div class="ml-4 text-right">
              <div class="text-2xl font-black text-slate-900">
                {{ challenge.prizeAmount | currency : 'EGP ' : 'symbol' : '1.0-0' }}
              </div>
              <div class="text-xs text-slate-400 font-bold uppercase tracking-wide">Prize Pool</div>
            </div>
          </div>

          <!-- Active Stats Grid -->
          <div
            *ngIf="challenge.status !== 'closed'"
            class="grid grid-cols-3 gap-3 mb-6 bg-slate-50/80 rounded-xl p-3 border border-slate-100"
          >
            <div class="text-center border-r border-slate-200 last:border-0">
              <div class="text-xs text-slate-500 font-medium mb-1">Time Left</div>
              <!-- Using helper method for days calculation -->
              <div
                class="text-sm font-bold"
                [ngClass]="
                  getDaysLeft(challenge.deadline) === 'Ended' ? 'text-red-600' : 'text-slate-800'
                "
              >
                {{ getDaysLeft(challenge.deadline) }}
              </div>
            </div>
            <div class="text-center border-r border-slate-200 last:border-0">
              <div class="text-xs text-slate-500 font-medium mb-1">Submissions</div>
              <div class="text-sm font-bold text-slate-800">
                {{ challenge.submissionCount || 0 }}
              </div>
            </div>
            <div class="text-center">
              <div class="text-xs text-slate-500 font-medium mb-1">Status</div>
              <div class="text-sm font-bold text-slate-800">Open</div>
            </div>
          </div>

          <!-- Winner Banner (Closed) -->
          <div
            *ngIf="challenge.status === 'closed' && challenge.winner"
            class="mb-6 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl p-4 border border-emerald-100 flex items-center gap-4"
          >
            <div
              class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-yellow-500 shadow-sm border border-emerald-100"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                ></path>
              </svg>
            </div>
            <div>
              <p class="text-xs text-emerald-700 font-bold uppercase">Challenge Winner</p>
              <p class="text-sm font-bold text-slate-900">{{ challenge.winner.name }}</p>
            </div>
            <div class="ml-auto text-right">
              <span class="text-xl font-bold text-emerald-700">{{
                challenge.winnerScore || 95
              }}</span>
              <span class="text-xs text-emerald-600 block">Score</span>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex items-center gap-3 mt-4">
            <a
              [routerLink]="['/dashboard/challenger/challenge', challenge._id]"
              class="flex-1 text-center py-2.5 bg-slate-900 text-white rounded-lg hover:bg-slate-800 font-semibold text-sm transition-all shadow-md shadow-slate-200"
            >
              {{ challenge.status === 'closed' ? 'View Results' : 'Manage Challenge' }}
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="space-y-6" *ngIf="activeTab !== 'create'">
      <!-- Wallet Card (Modern) -->
      <div
        class="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl p-6 text-white shadow-xl shadow-blue-200 relative overflow-hidden"
      >
        <div
          class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10 blur-2xl"
        ></div>

        <div class="relative z-10">
          <div class="flex items-center gap-2 mb-6 opacity-80">
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
            <span class="text-sm font-medium tracking-wide">Business Wallet</span>
          </div>

          <div class="mb-6">
            <p class="text-sm opacity-70 mb-1">Available Balance</p>
            <h3 class="text-3xl font-bold tracking-tight">
              {{ wallet.balance - wallet.escrow || 0 | currency : 'EGP ' }}
            </h3>
          </div>

          <div class="flex items-center justify-between pt-4 border-t border-white/20">
            <div>
              <p class="text-xs opacity-60">Escrow (Locked)</p>
              <p class="font-semibold">{{ wallet.escrow || 0 | currency : 'EGP ' }}</p>
            </div>
            <button
              class="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-xs font-bold transition-colors backdrop-blur-md"
            >
              + Top Up
            </button>
          </div>
        </div>
      </div>

      <!-- Performance Metrics -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
        <h3 class="text-lg font-bold text-slate-900 mb-5">Engagement Stats</h3>
        <div class="space-y-4">
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-500 font-medium">Avg Participants</span>
              <span class="font-bold text-slate-800">58</span>
            </div>
            <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden">
              <div class="h-full bg-blue-500 w-[58%] rounded-full"></div>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-slate-500 font-medium">Completion Rate</span>
              <span class="font-bold text-slate-800">82%</span>
            </div>
            <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden">
              <div class="h-full bg-purple-500 w-[82%] rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Leaderboard -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-slate-900">Top Candidates</h3>
          <a href="#" class="text-xs text-blue-600 font-bold hover:underline">View All</a>
        </div>

        <div class="space-y-3">
          <div
            *ngFor="let candidate of topCandidates; let i = index"
            class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100 cursor-pointer"
          >
            <div class="relative">
              <div
                class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600 text-xs overflow-hidden"
              >
                {{ candidate.name.substring(0, 2).toUpperCase() }}
              </div>
              <div
                *ngIf="i < 3"
                [ngClass]="{
                  'bg-yellow-400': i === 0,
                  'bg-slate-400': i === 1,
                  'bg-orange-400': i === 2
                }"
                class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white flex items-center justify-center text-[8px] font-bold text-white"
              >
                {{ i + 1 }}
              </div>
            </div>

            <div class="flex-1 min-w-0">
              <h4 class="text-sm font-bold text-slate-900 truncate">{{ candidate.name }}</h4>
              <p class="text-xs text-slate-500">Video Specialist</p>
            </div>

            <div class="text-sm font-bold text-slate-700 bg-slate-100 px-2 py-1 rounded-md">
              {{ candidate.score }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CREATE CHALLENGE FORM (Centered) -->
    <div
      class="lg:col-span-3 max-w-4xl mx-auto w-full animate-fade-in"
      *ngIf="activeTab === 'create'"
    >
      <div class="mb-8 text-center">
        <h2 class="text-3xl font-bold text-slate-900 mb-2">Create New Challenge</h2>
        <p class="text-slate-500 max-w-lg mx-auto">
          Define your requirements, set the prize, and let our AI help you find the best talent.
        </p>
      </div>

      <div class="bg-white rounded-3xl p-8 border border-slate-200 shadow-xl shadow-slate-200/50">
        <form [formGroup]="createForm" (ngSubmit)="onSubmitChallenge()" class="space-y-8">
          <!-- Section 1: Basic Info -->
          <div>
            <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
              <span
                class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs"
                >1</span
              >
              Basic Details
            </h3>

            <div class="space-y-4 pl-8">
              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2"
                  >Challenge Title <span class="text-red-500">*</span></label
                >
                <input
                  formControlName="title"
                  type="text"
                  [class.border-red-500]="isFieldInvalid('title')"
                  placeholder="e.g. Build a Task Management Chrome Extension"
                  class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all text-sm"
                />
                <p *ngIf="isFieldInvalid('title')" class="text-red-500 text-xs mt-1">
                  Title is required (min 5 chars)
                </p>
              </div>

              <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2"
                  >Description <span class="text-red-500">*</span></label
                >
                <textarea
                  formControlName="description"
                  rows="4"
                  [class.border-red-500]="isFieldInvalid('description')"
                  placeholder="Describe what participants need to build, expected outcomes, and technical requirements..."
                  class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all text-sm resize-none"
                ></textarea>
                <p *ngIf="isFieldInvalid('description')" class="text-red-500 text-xs mt-1">
                  Description is required
                </p>
              </div>
            </div>
          </div>

          <hr class="border-slate-100" />

          <!-- Section 2: Category & Settings -->
          <div>
            <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
              <span
                class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs"
                >2</span
              >
              Category & Settings
            </h3>

            <div class="pl-8">
              <label class="text-sm font-bold text-slate-700 block mb-3">Select Category</label>
              <!-- High-Performance Tile Selection -->
              <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                <label
                  *ngFor="let cat of categories; trackBy: trackByName"
                  class="cursor-pointer group relative"
                >
                  <input
                    type="radio"
                    formControlName="category"
                    [value]="cat.name"
                    class="peer sr-only"
                  />

                  <!-- The Modern Tile -->
                  <div
                    class="flex flex-col items-center justify-center p-4 rounded-xl border-2 border-slate-100 bg-white transition-all duration-200 ease-in-out hover:border-slate-300 hover:bg-slate-50 peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-1 peer-checked:ring-blue-600"
                  >
                    <!-- Icon -->
                    <div class="mb-2 text-slate-400 peer-checked:text-blue-600 transition-colors">
                      <!-- Dynamic SVG based on Icon Name -->
                      <svg
                        *ngIf="cat.icon === 'code'"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polyline points="16 18 22 12 16 6"></polyline>
                        <polyline points="8 6 2 12 8 18"></polyline>
                      </svg>
                      <svg
                        *ngIf="cat.icon === 'pen-tool'"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                        <path d="M2 2l7.586 7.586"></path>
                        <circle cx="11" cy="11" r="2"></circle>
                      </svg>
                      <svg
                        *ngIf="cat.icon === 'trending-up'"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                      </svg>
                      <svg
                        *ngIf="cat.icon === 'video'"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                      </svg>
                      <svg
                        *ngIf="cat.icon === 'file-text'"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                      </svg>
                    </div>

                    <span
                      class="text-xs font-bold text-slate-600 peer-checked:text-blue-700 tracking-wide"
                      >{{ cat.name }}</span
                    >
                  </div>
                </label>
              </div>

              <!-- Details Grid -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Difficulty</label>
                  <select
                    formControlName="difficulty"
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="easy">Easy (Beginner)</option>
                    <option value="medium">Medium (Intermediate)</option>
                    <option value="hard">Hard (Expert)</option>
                  </select>
                </div>

                <!-- Duration Input -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2"
                    >Duration (Days)</label
                  >
                  <input
                    formControlName="duration"
                    type="number"
                    min="1"
                    max="60"
                    placeholder="7"
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-bold"
                  />
                </div>

                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2"
                    >Required Skills</label
                  >
                  <input
                    formControlName="skills"
                    type="text"
                    placeholder="React, Figma, SEO"
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>
            </div>
          </div>

          <hr class="border-slate-100" />

          <!-- Section 3: Rewards -->
          <div>
            <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
              <span
                class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs"
                >3</span
              >
              Rewards
            </h3>

            <div class="pl-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2"
                    >Prize Amount</label
                  >
                  <div class="relative group">
                    <span
                      class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold group-focus-within:text-blue-600"
                      >EGP</span
                    >
                    <input
                      formControlName="prizeAmount"
                      type="number"
                      placeholder="5000"
                      [class.border-red-500]="isFieldInvalid('prizeAmount')"
                      class="w-full pl-14 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all font-mono font-bold text-slate-900 text-lg"
                    />
                  </div>
                  <p *ngIf="isFieldInvalid('prizeAmount')" class="text-red-500 text-xs mt-1">
                    Minimum prize is 100 EGP
                  </p>
                </div>

                <!-- Optimized Type Selection -->
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2"
                    >Opportunity Type</label
                  >
                  <div class="flex gap-4">
                    <!-- Type 1 -->
                    <label class="flex-1 cursor-pointer">
                      <input
                        type="radio"
                        formControlName="type"
                        value="prize"
                        class="peer sr-only"
                      />
                      <div
                        class="px-4 py-3 rounded-xl border-2 border-slate-100 bg-white hover:border-slate-300 peer-checked:border-blue-600 peer-checked:bg-blue-50 transition-all text-center"
                      >
                        <span class="text-sm font-bold text-slate-700 peer-checked:text-blue-700"
                          >One-time Prize</span
                        >
                      </div>
                    </label>
                    <!-- Type 2 -->
                    <label class="flex-1 cursor-pointer">
                      <input type="radio" formControlName="type" value="job" class="peer sr-only" />
                      <div
                        class="px-4 py-3 rounded-xl border-2 border-slate-100 bg-white hover:border-slate-300 peer-checked:border-purple-600 peer-checked:bg-purple-50 transition-all text-center"
                      >
                        <span class="text-sm font-bold text-slate-700 peer-checked:text-purple-700"
                          >Hiring / Job</span
                        >
                      </div>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Summary Box -->
              <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
                <h4 class="font-bold text-blue-900 mb-2 text-sm">Escrow Summary</h4>
                <p class="text-xs text-blue-700/80 mb-4 leading-relaxed">
                  To publish this challenge, the prize amount will be securely held in Escrow until
                  you select a winner.
                </p>
                <div
                  class="flex items-center justify-between text-sm font-semibold text-blue-900 pt-3 border-t border-blue-200/50"
                >
                  <span>Total to deduct:</span>
                  <span class="text-lg">{{
                    createForm.value.prizeAmount || 0 | currency : 'EGP '
                  }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-slate-100 mt-8">
            <button
              type="button"
              (click)="switchTab('active')"
              class="px-8 py-3.5 bg-white text-slate-700 rounded-xl hover:bg-slate-50 transition-all font-bold border border-slate-200 order-2 sm:order-1"
            >
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="isLoading"
              class="flex-1 px-6 py-3.5 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-all font-bold shadow-lg shadow-slate-900/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 order-1 sm:order-2"
            >
              <svg
                *ngIf="isLoading"
                class="animate-spin -ml-1 mr-2 h-5 w-5 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              {{ isLoading ? 'Publishing Challenge...' : 'Publish Challenge Now' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
