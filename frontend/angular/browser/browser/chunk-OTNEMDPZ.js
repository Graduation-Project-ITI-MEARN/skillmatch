import{b as R,f as g}from"./chunk-GEE437AJ.js";import{c as w}from"./chunk-CADW372H.js";import{b as j}from"./chunk-5FFKEXUF.js";import{w as y}from"./chunk-OAPWU2O3.js";import{Ca as x,E as I,R as L,V as l,Z as d,_ as u,f as k,ia as C,o as p,pa as A,t as b}from"./chunk-565OUHKP.js";function f(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)r[o]=t[o]}return r}var O={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function S(r,e){function t(i,c,n){if(!(typeof document>"u")){n=f({},e,n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires&&(n.expires=n.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in n)n[a]&&(s+="; "+a,n[a]!==!0&&(s+="="+n[a].split(";")[0]));return document.cookie=i+"="+r.write(c,i)+s}}function o(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var c=document.cookie?document.cookie.split("; "):[],n={},s=0;s<c.length;s++){var a=c[s].split("="),F=a.slice(1).join("=");try{var U=decodeURIComponent(a[0]);if(n[U]=r.read(F,U),i===U)break}catch{}}return i?n[i]:n}}return Object.create({set:t,get:o,remove:function(i,c){t(i,"",f({},c,{expires:-1}))},withAttributes:function(i){return S(this.converter,f({},this.attributes,i))},withConverter:function(i){return S(f({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var h=S(O,{path:"/"});var m=class r{get(e){return h.get(e)}set(e,t,o=7){h.set(e,t,{expires:o,path:"/"})}delete(e){h.remove(e,{path:"/"})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}};var v=class r{constructor(e,t,o){this.translate=e;this.platformId=t;this.document=o;this.supportedLangs=["en","ar"];this.defaultLang="en";this.translate.addLangs(this.supportedLangs),this.translate.setDefaultLang(this.defaultLang),this.initializeLanguage()}initializeLanguage(){if(y(this.platformId)){let e=this.defaultLang,t=this.getCookie("app_lang"),o=localStorage.getItem("lang"),i=navigator.language.split("-")[0];t&&this.supportedLangs.includes(t)?(console.log("LanguageService: Found Cookie from Next.js ->",t),e=t):o&&this.supportedLangs.includes(o)?e=o:this.supportedLangs.includes(i)&&(e=i),this.setLanguage(e)}}getCookie(e){let t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null}setLanguage(e){if(this.translate.use(e),y(this.platformId)){localStorage.setItem("lang",e);let t=e==="ar"?"rtl":"ltr";this.document.documentElement.setAttribute("lang",e),this.document.documentElement.setAttribute("dir",t),t==="rtl"?(this.document.body.classList.add("rtl","font-arabic"),this.document.body.classList.remove("ltr","font-english")):(this.document.body.classList.add("ltr","font-english"),this.document.body.classList.remove("rtl","font-arabic"))}}getLangauge(){return this.translate.currentLang}static{this.\u0275fac=function(t){return new(t||r)(d(R),d(x),d(C))}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}};var E=class r{constructor(){this.http=u(j);this.cookiesService=u(m);this.router=u(w);this.languageService=u(v);this.lang=this.languageService.getLangauge();this.currentUser=A(null);console.log("AuthService constructor: Initiating initial user verification."),this.verifyUser().subscribe()}verifyUser(){return this.currentUser()!==null?p(this.currentUser()):this.http.get(`${g.apiUrl}/auth/me`).pipe(L(e=>{e.success&&e.data?(console.log("AuthService: User verified and signal updated:",e.data),this.currentUser.set(e.data),this.cookiesService.set("user_type",e.data.type||""),this.cookiesService.set("user_role",e.data.role||"")):(console.log("AuthService: Verification response not successful, clearing user."),this.clearUserAndCookies())}),b(e=>e.success?e.data:null),I(e=>(console.error("AuthService: Verification failed via API:",e),this.clearUserAndCookies(),p(null))))}clearUserAndCookies(){this.currentUser.set(null),this.cookiesService.delete("user_role"),this.cookiesService.delete("user_type"),this.cookiesService.delete("JSESSIONID")}checkAuth(){return this.currentUser()?p(!0):this.verifyUser().pipe(b(e=>!!e))}logout(){this.http.get(`${g.apiUrl}/auth/logout`).subscribe({next:()=>console.log("Backend logout successful"),error:e=>console.error("Backend logout failed",e),complete:()=>{this.clearUserAndCookies(),console.log("Frontend logout successful"),window.location.href=`${g.nextJsUrl}/${this.lang}/login`}})}get role(){return this.currentUser()?.role||this.cookiesService.get("user_role")||""}get type(){let e=this.currentUser()?.type,t=this.cookiesService.get("user_type");return e||(t==="candidate"||t==="company"||t==="challenger"?t:null)}get currentUserId(){return this.currentUser()?.id||null}refreshUserProfile(){return console.log("AuthService: Refreshing user profile.",this.currentUser()),this.currentUser.set(null),this.verifyUser()}get isSubscribed(){let e=this.currentUser();return e?.subscriptionStatus==="active"&&e?.subscriptionExpiry?new Date(e.subscriptionExpiry)>new Date:!1}get subscriptionPlan(){return this.currentUser()?.subscriptionPlan||null}canUseCustomAIModels(){let e=this.subscriptionPlan;return e==="professional"||e==="enterprise"}refreshUser(){return k(this,null,function*(){yield this.refreshUserProfile().toPromise()})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})}};export{m as a,v as b,E as c};
