import{A as I,B as Y,fb as q,jb as G,k as X,lb as J,mb as Q,u as K}from"./chunk-XQKT32VU.js";import{c as P,e as U,f as z}from"./chunk-GEE437AJ.js";import{b as L}from"./chunk-5FFKEXUF.js";import{j as H,p as $,s as j}from"./chunk-OAPWU2O3.js";import{Ab as g,Ac as h,Bc as V,Db as M,Eb as B,Fb as p,Gb as a,Hb as r,Ib as c,Pb as A,Ub as m,V as T,Va as O,Wa as n,Wb as l,_ as u,a as N,b as k,da as C,ea as v,gc as F,ic as d,jc as D,kb as E,kc as _,pa as b,t as S,ya as R,zb as f,zc as x}from"./chunk-565OUHKP.js";var y=class i{constructor(){this.http=u(L);this.apiUrl=`${z.apiUrl}/notifications`}getMyNotifications(){return this.http.get(this.apiUrl).pipe(S(e=>e.data||[]))}markAsRead(e){return this.http.put(`${this.apiUrl}/${e}/read`,{})}markAllAsRead(){return this.http.put(`${this.apiUrl}/read-all`,{})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=T({token:i,factory:i.\u0275fac,providedIn:"root"})}};var et=(i,e)=>e._id;function it(i,e){i&1&&c(0,"span",3)}function nt(i,e){if(i&1){let t=A();a(0,"button",25),m("click",function(s){C(t);let w=l().$implicit,Z=l(3);return v(Z.markAsRead(w._id,s))}),c(1,"lucide-icon",26),r()}if(i&2){let t=l(4);n(),p("img",t.icons.Check)}}function ot(i,e){i&1&&c(0,"div",24)}function rt(i,e){if(i&1&&(a(0,"div",15)(1,"div",16)(2,"div",17),c(3,"lucide-icon",18),r(),a(4,"div",19)(5,"p",20),d(6),r(),a(7,"p",21),d(8),r(),a(9,"p",22),d(10),x(11,"date"),r()(),f(12,nt,2,1,"button",23)(13,ot,1,0,"div",24),r()()),i&2){let t=e.$implicit,o=l(3);F("bg-orange-50_30",!t.isRead),n(2),p("ngClass",o.getIconStyles(t.type).bg),n(),p("img",o.getIconStyles(t.type).icon)("ngClass",o.getIconStyles(t.type).text),n(3),D(t.title),n(2),D(t.message),n(2),_(" ",V(11,9,t.createdAt,"shortTime")," "),n(2),g(t.isRead?13:12)}}function at(i,e){if(i&1&&(a(0,"div",10),M(1,rt,14,12,"div",14,et),r()),i&2){let t=l(2);n(),B(t.notifications())}}function st(i,e){i&1&&(a(0,"div",11),d(1),x(2,"translate"),r()),i&2&&(n(),_(" ",h(2,1,"DASHBOARD.NOTIFICATIONS.EMPTY")," "))}function lt(i,e){if(i&1){let t=A();a(0,"div",4)(1,"div",5)(2,"h3",6),d(3),x(4,"translate"),r(),a(5,"button",7),m("click",function(){C(t);let s=l();return v(s.close())}),c(6,"lucide-icon",8),r()(),a(7,"div",9),f(8,at,3,0,"div",10)(9,st,3,3,"div",11),r(),a(10,"div",12)(11,"button",13),m("click",function(){C(t);let s=l();return v(s.markAllAsRead())}),d(12),x(13,"translate"),r()()()}if(i&2){let t=l();n(3),_(" ",h(4,4,"DASHBOARD.NOTIFICATIONS.TITLE")," "),n(3),p("img",t.icons.X),n(2),g(t.notifications().length>0?8:9),n(4),_(" ",h(13,6,"DASHBOARD.NOTIFICATIONS.MARK_ALL_AS_READ")," ")}}var W=class i{constructor(){this.notifService=u(y);this.eRef=u(R);this.isOpen=b(!1);this.notifications=b([]);this.unreadCount=b(0);this.icons={Bell:X,X:G,Check:K}}ngOnInit(){this.refresh()}refresh(){this.notifService.getMyNotifications().subscribe({next:e=>{this.notifications.set(e),this.updateCount()},error:()=>console.error("Failed to load notifications")})}updateCount(){let e=this.notifications().filter(t=>!t.isRead).length;this.unreadCount.set(e)}toggle(){this.isOpen.update(e=>!e)}close(){this.isOpen.set(!1)}markAsRead(e,t){t.stopPropagation(),this.notifications.update(o=>o.map(s=>s._id===e?k(N({},s),{isRead:!0}):s)),this.updateCount(),this.notifService.markAsRead(e).subscribe()}markAllAsRead(){this.notifications.update(e=>e.map(t=>k(N({},t),{isRead:!0}))),this.updateCount(),this.notifService.markAllAsRead().subscribe()}clickout(e){this.eRef.nativeElement.contains(e.target)||this.isOpen.set(!1)}getIconStyles(e="info"){switch(e){case"success":return{bg:"bg-green-100",text:"text-green-600",icon:Y};case"warning":return{bg:"bg-yellow-100",text:"text-yellow-600",icon:I};case"error":return{bg:"bg-red-100",text:"text-red-600",icon:I};case"info":default:return{bg:"bg-orange-100",text:"text-orange-600",icon:q}}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["app-notifications-dropdown"]],hostBindings:function(t,o){t&1&&m("click",function(w){return o.clickout(w)},O)},decls:5,vars:3,consts:[[1,"relative"],[1,"relative","p-2","hover:bg-gray-100","rounded-lg","transition-all","border","border-transparent","focus:border-gray-200","outline-none",3,"click"],[1,"w-5","h-5","text-gray-600",3,"img"],[1,"absolute","top-1","right-1","w-2","h-2","bg-orange-500","rounded-full","border","border-white"],[1,"absolute","end-0","mt-2","w-96","bg-white","rounded-xl","shadow-xl","border","border-gray-200","z-50","origin-top-right","rtl:origin-top-left","animate-in","fade-in","zoom-in-95","duration-100"],[1,"p-4","border-b","border-gray-200","flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"p-1","hover:bg-gray-100","rounded","transition-all","text-gray-500","hover:text-gray-700",3,"click"],[1,"w-4","h-4",3,"img"],[1,"max-h-96","overflow-y-auto"],[1,"divide-y","divide-gray-100"],[1,"p-8","text-center","text-gray-500","text-sm"],[1,"p-3","border-t","border-gray-200","bg-gray-50/50","rounded-b-xl"],[1,"w-full","text-center","text-xs","text-gray-600","hover:text-gray-900","font-medium","transition-all",3,"click"],[1,"p-4","hover:bg-gray-50","transition-all","cursor-default","group",3,"bg-orange-50_30"],[1,"p-4","hover:bg-gray-50","transition-all","cursor-default","group"],[1,"flex","items-start","gap-3","text-start"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","shrink-0",3,"ngClass"],[1,"w-4","h-4",3,"img","ngClass"],[1,"flex-1","min-w-0"],[1,"text-sm","mb-1","font-medium","text-gray-900"],[1,"text-xs","text-gray-600","leading-snug"],[1,"text-xs","text-gray-400","mt-1"],["title","Mark as read",1,"p-1","hover:bg-gray-200","rounded","transition-all","group-hover:opacity-100"],[1,"w-6"],["title","Mark as read",1,"p-1","hover:bg-gray-200","rounded","transition-all","group-hover:opacity-100",3,"click"],[1,"w-4","h-4","text-gray-400","group-hover:text-orange-600",3,"img"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"button",1),m("click",function(){return o.toggle()}),c(2,"lucide-icon",2),f(3,it,1,0,"span",3),r(),f(4,lt,14,8,"div",4),r()),t&2&&(n(2),p("img",o.icons.Bell),n(),g(o.unreadCount()>0?3:-1),n(),g(o.isOpen()?4:-1))},dependencies:[j,H,Q,J,U,$,P],encapsulation:2})}};export{W as a};
