import{a as E,b as h,c as g}from"./chunk-2YIDOPGG.js";import{l as F,w as j,y as K,z as U}from"./chunk-2DHYFB3B.js";import{a as Le,b as Ze,c as Be}from"./chunk-ZKGESBBT.js";import{a as ze}from"./chunk-PFQCF4BB.js";import{A as _e,O as ne,Pa as Ve,X as oe,a as te,fb as re,ib as Y,k as Oe,la as ke,lb as Ne,mb as He}from"./chunk-XQKT32VU.js";import{c as xe,e as Ae,f as Ee}from"./chunk-GEE437AJ.js";import{b as Re,g as Te}from"./chunk-CADW372H.js";import"./chunk-EZWRTDAZ.js";import{b as Se}from"./chunk-5FFKEXUF.js";import{s as Ie,w as P}from"./chunk-OAPWU2O3.js";import{Ac as Ce,Ca as V,Db as fe,Dc as Z,Eb as he,Fb as M,Gb as I,Hb as S,Ib as R,Ic as f,Jb as T,Kb as x,Lc as Me,Mb as ve,Mc as a,Nb as ge,Nc as B,Pb as J,Ub as y,V as _,Va as ce,Vb as ee,W as pe,Wa as C,Wb as A,Xb as m,Yb as p,_ as i,a as W,b as G,cc as z,da as b,dc as L,ea as D,fc as ye,gb as N,hc as u,ic as we,kb as d,kc as be,lb as me,mb as ue,pa as c,qb as H,wb as l,ya as k,zc as De}from"./chunk-565OUHKP.js";var q=E("bg-popover text-popover-foreground z-50 min-w-[200px] overflow-y-auto rounded-md border py-1 px-1 shadow-md"),Pe=E("relative flex cursor-pointer select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:bg-accent focus-visible:text-accent-foreground data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"",destructive:"text-destructive hover:bg-destructive/10 focus:bg-destructive/10 dark:hover:bg-destructive/20 dark:focus:bg-destructive/20 focus:text-destructive"},inset:{true:"pl-8",false:""}},defaultVariants:{variant:"default",inset:!1}}),Fe=E("relative flex items-center px-2 py-1.5 text-sm font-medium text-muted-foreground",{variants:{inset:{true:"pl-8",false:""}},defaultVariants:{inset:!1}}),je=E("ml-auto text-xs tracking-widest text-muted-foreground");var Ue=["contentTemplate"],Ye=["*"];function qe(o,e){if(o&1&&(T(0,"div",1),p(1),x()),o&2){let t=A();u(t.contentClasses()),l("aria-orientation","vertical")}}var ie=class o{constructor(){this.contentTemplate=B.required("contentTemplate");this.class=a("");this.contentClasses=f(()=>h(q(),this.class()))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["z-dropdown-menu-content"]],viewQuery:function(t,n){t&1&&z(n.contentTemplate,Ue,5),t&2&&L()},hostVars:2,hostBindings:function(t,n){t&2&&ye("display","none")},inputs:{class:[1,"class"]},exportAs:["zDropdownMenuContent"],ngContentSelectors:Ye,decls:2,vars:0,consts:[["contentTemplate",""],["role","menu","tabindex","-1"]],template:function(t,n){t&1&&(m(),H(0,qe,2,3,"ng-template",null,0,Z))},encapsulation:2})}};var $e=["*"],ae=class o{constructor(){this.class=a("");this.classes=f(()=>h(je(),this.class()))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["z-dropdown-menu-shortcut"],["","z-dropdown-menu-shortcut",""]],hostVars:2,hostBindings:function(t,n){t&2&&u(n.classes())},inputs:{class:[1,"class"]},exportAs:["zDropdownMenuShortcut"],ngContentSelectors:$e,decls:1,vars:0,template:function(t,n){t&1&&(m(),p(0))},encapsulation:2})}};var Xe=["*"],se=class o{constructor(){this.inset=a(!1,{transform:g});this.class=a("");this.classes=f(()=>h(Fe({inset:this.inset()}),this.class()))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["z-dropdown-menu-label"],["","z-dropdown-menu-label",""]],hostVars:3,hostBindings:function(t,n){t&2&&(l("data-inset",n.inset()||null),u(n.classes()))},inputs:{inset:[1,"inset"],class:[1,"class"]},exportAs:["zDropdownMenuLabel"],ngContentSelectors:Xe,decls:1,vars:0,template:function(t,n){t&1&&(m(),p(0))},encapsulation:2})}};var w=class o{constructor(){this.overlay=i(K);this.overlayPositionBuilder=i(j);this.platformId=i(V);this.focusedIndex=c(-1);this.isOpen=c(!1)}toggle(e,t,n){this.isOpen()?this.close():this.open(e,t,n)}open(e,t,n){this.isOpen()&&this.close(),this.triggerElement=e,this.createOverlay(e),this.overlayRef&&(this.portal=new F(t,n),this.overlayRef.attach(this.portal),this.isOpen.set(!0),setTimeout(()=>{this.setupKeyboardNavigation(),this.focusFirstItem()},0),this.outsideClickSubscription=this.overlayRef.outsidePointerEvents().subscribe(()=>{this.close()}))}close(){this.overlayRef?.hasAttached()&&this.overlayRef.detach(),this.isOpen.set(!1),this.focusedIndex.set(-1),this.destroyOverlay()}createOverlay(e){this.overlayRef&&this.destroyOverlay();let t=this.overlayPositionBuilder.flexibleConnectedTo(e).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetY:4},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetY:-4}]).withPush(!1);this.overlayRef=this.overlay.create({positionStrategy:t,hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.reposition(),minWidth:200,maxHeight:400})}destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=void 0,this.outsideClickSubscription&&this.outsideClickSubscription.unsubscribe())}setupKeyboardNavigation(){if(!this.overlayRef?.hasAttached()||!P(this.platformId))return;let e=this.overlayRef.overlayElement.querySelector('[role="menu"]');e&&(e.addEventListener("keydown",t=>{let n=this.getDropdownItems();switch(t.key){case"ArrowDown":t.preventDefault(),this.navigateItems(1,n);break;case"ArrowUp":t.preventDefault(),this.navigateItems(-1,n);break;case"Enter":case" ":t.preventDefault(),this.selectFocusedItem(n);break;case"Escape":t.preventDefault(),this.close(),this.triggerElement?.nativeElement.focus();break;case"Home":t.preventDefault(),this.focusItemAtIndex(n,0);break;case"End":t.preventDefault(),this.focusItemAtIndex(n,n.length-1);break}}),e.focus())}getDropdownItems(){if(!this.overlayRef?.hasAttached())return[];let e=this.overlayRef.overlayElement;return Array.from(e.querySelectorAll("z-dropdown-menu-item, [z-dropdown-menu-item]")).filter(t=>t.dataset.disabled===void 0)}navigateItems(e,t){if(t.length===0)return;let r=this.focusedIndex()+e;r<0?r=t.length-1:r>=t.length&&(r=0),this.focusItemAtIndex(t,r)}focusItemAtIndex(e,t){t>=0&&t<e.length&&(this.focusedIndex.set(t),this.updateItemFocus(e,t))}focusFirstItem(){let e=this.getDropdownItems();e.length>0&&this.focusItemAtIndex(e,0)}selectFocusedItem(e){let t=this.focusedIndex();t>=0&&t<e.length&&e[t].click()}updateItemFocus(e,t){for(let n=0;n<e.length;n++){let r=e[n];n===t?(r.focus(),r.dataset.highlighted=""):delete r.dataset.highlighted}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=_({token:o,factory:o.\u0275fac,providedIn:"root"})}};var Qe=["*"],de=class o{constructor(){this.dropdownService=i(w);this.variant=a("default");this.inset=a(!1,{transform:g});this.disabled=a(!1,{transform:g});this.class=a("");this.classes=f(()=>h(Pe({variant:this.variant(),inset:this.inset()}),this.class()))}onClick(e){if(this.disabled()){e.preventDefault(),e.stopPropagation();return}setTimeout(()=>{this.dropdownService.close()},0)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["z-dropdown-menu-item"],["","z-dropdown-menu-item",""]],hostAttrs:["role","menuitem","tabindex","-1"],hostVars:6,hostBindings:function(t,n){t&1&&y("click",function(s){return n.onClick(s)}),t&2&&(l("data-disabled",n.disabled()||null)("data-variant",n.variant())("data-inset",n.inset()||null)("aria-disabled",n.disabled()),u(n.classes()))},inputs:{variant:[1,"variant"],inset:[1,"inset"],disabled:[1,"disabled"],class:[1,"class"]},exportAs:["zDropdownMenuItem"],ngContentSelectors:Qe,decls:1,vars:0,template:function(t,n){t&1&&(m(),p(0))},encapsulation:2})}};var le=class o{constructor(){this.elementRef=i(k);this.viewContainerRef=i(N);this.dropdownService=i(w);this.zDropdownMenu=a();this.zTrigger=a("click");this.zDisabled=a(!1)}ngOnInit(){let e=this.elementRef.nativeElement;if(!e.hasAttribute("aria-label")&&!e.hasAttribute("aria-labelledby")){let t=e.textContent?.trim();e.setAttribute("aria-label",t?.length?t:"Open menu")}}onClick(e){if(this.zDisabled()||this.zTrigger()!=="click")return;e.preventDefault(),e.stopPropagation();let t=this.zDropdownMenu();t&&this.dropdownService.toggle(this.elementRef,t?.contentTemplate?.(),this.viewContainerRef)}onMouseEnter(){if(this.zDisabled()||this.zTrigger()!=="hover")return;let e=this.zDropdownMenu();e&&this.dropdownService.open(this.elementRef,e?.contentTemplate?.(),this.viewContainerRef)}onMouseLeave(){this.zDisabled()||this.zTrigger()!=="hover"||this.dropdownService.close()}onKeydown(e){if(!this.zDisabled())switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.toggleDropdown();break;case"ArrowDown":e.preventDefault(),this.openDropdown();break;case"Escape":e.preventDefault(),this.dropdownService.close(),this.elementRef.nativeElement.focus();break}}toggleDropdown(){let e=this.zDropdownMenu();e&&this.dropdownService.toggle(this.elementRef,e?.contentTemplate?.(),this.viewContainerRef)}openDropdown(){let e=this.zDropdownMenu();e&&!this.dropdownService.isOpen()&&this.dropdownService.open(this.elementRef,e?.contentTemplate?.(),this.viewContainerRef)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275dir=ue({type:o,selectors:[["","z-dropdown",""],["","zDropdown",""]],hostVars:5,hostBindings:function(t,n){t&1&&y("click",function(s){return n.onClick(s)})("mouseenter",function(){return n.onMouseEnter()})("mouseleave",function(){return n.onMouseLeave()})("keydown",function(s){return n.onKeydown(s)}),t&2&&l("tabindex",0)("role","button")("aria-haspopup","menu")("aria-expanded",n.dropdownService.isOpen())("aria-disabled",n.zDisabled())},inputs:{zDropdownMenu:[1,"zDropdownMenu"],zTrigger:[1,"zTrigger"],zDisabled:[1,"zDisabled"]},exportAs:["zDropdown"]})}};var We=["dropdownTemplate"],Ge=[[["","dropdown-trigger",""]],"*"],Je=["[dropdown-trigger]","*"];function et(o,e){if(o&1){let t=J();T(0,"div",2),ee("keydown",function(r){b(t);let s=A();return D(s.onDropdownKeydown(r))}),p(1,1),x()}if(o&2){let t=A();u(t.contentClasses()),l("data-state","open")}}var $=class o{constructor(){this.elementRef=i(k);this.overlay=i(K);this.overlayPositionBuilder=i(j);this.viewContainerRef=i(N);this.platformId=i(V);this.dropdownTemplate=B.required("dropdownTemplate");this.class=a("");this.disabled=a(!1,{transform:g});this.openChange=Me();this.isOpen=c(!1);this.focusedIndex=c(-1);this.contentClasses=f(()=>h(q(),this.class()))}ngOnInit(){setTimeout(()=>{this.createOverlay()})}ngOnDestroy(){this.destroyOverlay()}onDocumentClick(e){this.elementRef.nativeElement.contains(e.target)||this.close()}onDropdownKeydown(e){let t=this.getDropdownItems();switch(e.key){case"ArrowDown":e.preventDefault(),this.navigateItems(1,t);break;case"ArrowUp":e.preventDefault(),this.navigateItems(-1,t);break;case"Enter":case" ":e.preventDefault(),this.selectFocusedItem(t);break;case"Escape":e.preventDefault(),this.close(),this.focusTrigger();break;case"Home":e.preventDefault(),this.focusFirstItem(t);break;case"End":e.preventDefault(),this.focusLastItem(t);break}}toggle(){this.disabled()||(this.isOpen()?this.close():this.open())}open(){this.isOpen()||(this.overlayRef||this.createOverlay(),this.overlayRef&&(this.portal=new F(this.dropdownTemplate(),this.viewContainerRef),this.overlayRef.attach(this.portal),this.isOpen.set(!0),this.openChange.emit(!0),setTimeout(()=>{this.focusDropdown(),this.focusFirstItem(this.getDropdownItems())},0)))}close(){this.overlayRef?.hasAttached()&&this.overlayRef.detach(),this.isOpen.set(!1),this.focusedIndex.set(-1),this.openChange.emit(!1)}createOverlay(){if(!this.overlayRef&&P(this.platformId))try{let e=this.overlayPositionBuilder.flexibleConnectedTo(this.elementRef).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetY:4},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetY:-4}]).withPush(!1);this.overlayRef=this.overlay.create({positionStrategy:e,hasBackdrop:!1,scrollStrategy:this.overlay.scrollStrategies.reposition(),minWidth:200,maxHeight:400})}catch(e){console.error("Error creating overlay:",e)}}destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=void 0)}getDropdownItems(){if(!this.overlayRef?.hasAttached())return[];let e=this.overlayRef.overlayElement;return Array.from(e.querySelectorAll("z-dropdown-menu-item, [z-dropdown-menu-item]")).filter(t=>t.dataset.disabled===void 0)}navigateItems(e,t){if(t.length===0)return;let r=this.focusedIndex()+e;r<0?r=t.length-1:r>=t.length&&(r=0),this.focusedIndex.set(r),this.updateItemFocus(t,r)}selectFocusedItem(e){let t=this.focusedIndex();t>=0&&t<e.length&&e[t].click()}focusFirstItem(e){e.length>0&&(this.focusedIndex.set(0),this.updateItemFocus(e,0))}focusLastItem(e){if(e.length>0){let t=e.length-1;this.focusedIndex.set(t),this.updateItemFocus(e,t)}}updateItemFocus(e,t){e.forEach((n,r)=>{r===t?(n.focus(),n.setAttribute("data-highlighted","")):n.removeAttribute("data-highlighted")})}focusDropdown(){if(this.overlayRef?.hasAttached()){let e=this.overlayRef.overlayElement.querySelector('[role="menu"]');e&&e.focus()}}focusTrigger(){let e=this.elementRef.nativeElement.querySelector(".trigger-container");e&&e.focus()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["z-dropdown-menu"]],viewQuery:function(t,n){t&1&&z(n.dropdownTemplate,We,5),t&2&&L()},hostAttrs:[1,"relative","inline-block","text-left"],hostVars:1,hostBindings:function(t,n){t&1&&y("click",function(s){return n.onDocumentClick(s)},ce),t&2&&l("data-state",n.isOpen()?"open":"closed")},inputs:{class:[1,"class"],disabled:[1,"disabled"]},outputs:{openChange:"openChange"},exportAs:["zDropdownMenu"],ngContentSelectors:Je,decls:4,vars:0,consts:[["dropdownTemplate",""],["tabindex","0",1,"trigger-container",3,"click","keydown.enter","keydown.space"],["role","menu","tabindex","-1",3,"keydown"]],template:function(t,n){if(t&1){let r=J();m(Ge),T(0,"div",1),ee("click",function(){return b(r),D(n.toggle())})("keydown.enter",function(){return b(r),D(n.toggle())})("keydown.space",function(){return b(r),D(n.toggle())}),p(1),x(),H(2,et,2,3,"ng-template",null,0,Z)}},dependencies:[U],encapsulation:2,changeDetection:0})}};var X=class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=me({type:o})}static{this.\u0275inj=pe({imports:[U,$]})}};var Q=class o{constructor(){this.http=i(Se);this.apiUrl=`${Ee.apiUrl}`}getStats(){return this.http.get(`${this.apiUrl}/stats/admin`)}getNotifications(){return this.http.get(`${this.apiUrl}/notifications`)}markRead(e){return this.http.post(`${this.apiUrl}/:${e}/read`,{id:e})}markAllRead(){return this.http.post(`${this.apiUrl}/mark-all`,{})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=_({token:o,factory:o.\u0275fac,providedIn:"root"})}};var tt=(o,e)=>e.labelKey;function nt(o,e){if(o&1&&(I(0,"z-stat",6),R(1,"lucide-icon",7),S()),o&2){let t=e.$implicit;M("labelKey",t.labelKey)("value",t.value)("trend",t.trend),C(),M("img",t.icon)}}var Ke=class o{constructor(){this.theme=i(Be);this.adminService=i(Q);this.avatarIcon=Ve;this.stats=c([]);this.notifications=c([]);this.unreadCount=c(0);this.icons={Users:Y,DollarSign:ne,Flag:oe,Activity:te,Bell:Oe};this.tabs=[{labelKey:"DASHBOARD.TABS.OVERVIEW",route:"/dashboard/admin/overview",icon:ke},{labelKey:"DASHBOARD.TABS.USERS",route:"/dashboard/admin/users",icon:Y},{labelKey:"DASHBOARD.TABS.CHALLENGES",route:"/dashboard/admin/challenges",icon:re},{labelKey:"DASHBOARD.TABS.MODERATION",route:"/dashboard/admin/moderation",icon:oe},{labelKey:"DASHBOARD.TABS.ANALYTICS",route:"/dashboard/admin/analytics",icon:te}]}ngOnInit(){this.theme.setTheme("admin"),this.loadData()}loadData(){this.adminService.getStats().subscribe({next:e=>{e&&this.stats.set([{labelKey:"DASHBOARD.STATS.TOTAL_USERS",value:e.totalUsers?.toLocaleString()||"0",trend:"Total Registered",icon:Y,trendColor:"info"},{labelKey:"DASHBOARD.STATS.ACTIVE_CHALLENGES",value:e.activeChallenges?.toString()||"0",trend:"Active Challenges",icon:re,trendColor:"success"},{labelKey:"DASHBOARD.STATS.REVENUE",value:`$${e.revenue?.toLocaleString()||"0"}`,trend:"Total Revenue",icon:ne,trendColor:"success"},{labelKey:"DASHBOARD.STATS.REVIEWS",value:e.pendingReviews?.toString()||"0",trend:"Requires Attention",icon:_e,trendColor:"danger"}])},error:e=>console.error("Failed to load stats",e)}),this.adminService.getNotifications().subscribe({next:e=>{Array.isArray(e)?(this.notifications.set(e),this.unreadCount.set(e.filter(t=>!t.read).length)):(console.warn("Notifications API returned non-array:",e),this.notifications.set([]),this.unreadCount.set(0))},error:e=>{console.error("Failed to load notifications",e),this.notifications.set([])}})}onMarkAllRead(){this.adminService.markAllRead().subscribe(()=>{this.notifications.update(e=>e.map(t=>G(W({},t),{read:!0}))),this.unreadCount.set(0)})}onReadOne(e){this.adminService.markRead(e).subscribe(()=>{this.notifications.update(t=>t.map(n=>n.id===e?G(W({},n),{read:!0}):n)),this.unreadCount.update(t=>Math.max(0,t-1))})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=d({type:o,selectors:[["app-admin-shell"]],decls:12,vars:5,consts:[["titleKey","DASHBOARD.TITLES.ADMIN","subtitleKey","DASHBOARD.SUBTITLES.ADMIN",3,"tabs"],["avatar",""],[1,"w-7","h-7",3,"img"],["actions","",1,"flex","items-center","gap-3"],[1,"hidden","md:flex","px-4","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition-all","text-sm","font-medium"],["stats",""],[3,"labelKey","value","trend"],[1,"w-5","h-5",3,"img"]],template:function(t,n){t&1&&(I(0,"app-dashboard-layout",0)(1,"span",1),R(2,"lucide-icon",2),S(),I(3,"div",3),R(4,"app-notifications-dropdown"),I(5,"button",4),we(6),De(7,"translate"),S()(),ve(8,5),fe(9,nt,2,4,"z-stat",6,tt),ge(),R(11,"router-outlet"),S()),t&2&&(M("tabs",n.tabs),C(2),M("img",n.avatarIcon),C(4),be(" ",Ce(7,3,"DASHBOARD.ACTIONS.SYSTEM_REPORT")," "),C(3),he(n.stats()))},dependencies:[Ie,Te,Re,Ae,He,Ne,Le,Ze,X,ze,xe],encapsulation:2})}};export{Ke as AdminShellComponent};
