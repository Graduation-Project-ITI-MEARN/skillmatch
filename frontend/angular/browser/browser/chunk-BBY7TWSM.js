import{a as N}from"./chunk-M4ZVHGDV.js";import{c as E}from"./chunk-OTNEMDPZ.js";import{c as M,e as T,i as k,x as j}from"./chunk-CYRR275F.js";import{h as D}from"./chunk-LDRJV2AZ.js";import{f as U}from"./chunk-GEE437AJ.js";import{b as I}from"./chunk-5FFKEXUF.js";import{s as w}from"./chunk-OAPWU2O3.js";import{Ab as _,Fb as g,Gb as n,Hb as o,Ib as f,Ub as b,V as v,Wa as m,_ as d,ic as s,kb as y,kc as V,pa as h,pc as C,qc as x,rc as F,zb as S}from"./chunk-565OUHKP.js";var c=class i{constructor(){this.http=d(I)}uploadFile(t){let r=new FormData;return r.append("file",t),this.http.post(`${U.apiUrl}/upload/file`,r)}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})}};function z(i,t){i&1&&(n(0,"div",2),f(1,"span",11),s(2," Verification Pending "),o())}function A(i,t){i&1&&(n(0,"div",3),f(1,"span",12),s(2," Verification Rejected. Please resubmit or contact support. "),o())}function R(i,t){i&1&&(n(0,"div",4),f(1,"span",13),s(2," Verified "),o())}function W(i,t){i&1&&(n(0,"div",5),f(1,"span",14),s(2," Submit your documents for verification. "),o())}var p=class i{constructor(){this.uploadService=d(c);this.userService=d(N);this.authService=d(E);this.toast=d(D);this.user=this.authService.currentUser;this.nationalId="";this.documentUrl="";this.loading=h(!1)}onFileSelected(t){let r=t.target.files[0];r&&(this.loading.set(!0),this.uploadService.uploadFile(r).subscribe({next:e=>{this.documentUrl=e.url,this.loading.set(!1),this.toast.success("Document uploaded successfully")},error:()=>{this.loading.set(!1),this.toast.error("Upload failed")}}))}submit(){this.loading.set(!0),this.userService.requestVerification({nationalId:this.nationalId,documentUrl:this.documentUrl}).subscribe({next:t=>{this.toast.success("Verification submitted!"),this.authService.refreshUserProfile().subscribe({next:()=>{console.log("User profile refreshed after verification submission"),this.loading.set(!1)},error:r=>{console.error("Failed to refresh user profile after submission:",r),this.loading.set(!1)}})},error:t=>{this.loading.set(!1),this.toast.error(t.error?.message||"Submission failed")}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=y({type:i,selectors:[["app-verification-form"]],decls:18,vars:5,consts:[[1,"p-4","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"text-lg","font-bold","mb-4"],[1,"mb-4","p-3","bg-yellow-50","text-yellow-700","rounded-lg","border","border-yellow-200","flex","items-center","gap-2"],[1,"mb-4","p-3","bg-red-50","text-red-700","rounded-lg","border","border-red-200","flex","items-center","gap-2"],[1,"mb-4","p-3","bg-green-50","text-green-700","rounded-lg","border","border-green-200","flex","items-center","gap-2"],[1,"mb-4","p-3","bg-blue-50","text-blue-700","rounded-lg","border","border-blue-200","flex","items-center","gap-2"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700"],["type","text","placeholder","Enter ID number",1,"w-full","mt-1","p-2","border","rounded-md","focus:ring-2","focus:ring-primary",3,"ngModelChange","ngModel"],["type","file",1,"w-full","mt-1","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-gray-100","file:text-gray-700","hover:file:bg-gray-200",3,"change","disabled"],[1,"w-full","py-2","bg-black","text-white","rounded-md","hover:bg-gray-800","disabled:bg-gray-400","transition-colors",3,"click","disabled"],[1,"w-2","h-2","rounded-full","bg-yellow-500"],[1,"w-2","h-2","rounded-full","bg-red-500"],[1,"w-2","h-2","rounded-full","bg-green-500"],[1,"w-2","h-2","rounded-full","bg-blue-500"]],template:function(r,e){if(r&1&&(n(0,"div",0)(1,"h3",1),s(2,"Identity Verification"),o(),S(3,z,3,0,"div",2)(4,A,3,0,"div",3)(5,R,3,0,"div",4)(6,W,3,0,"div",5),n(7,"div",6)(8,"div")(9,"label",7),s(10,"National ID / Tax ID"),o(),n(11,"input",8),F("ngModelChange",function(l){return x(e.nationalId,l)||(e.nationalId=l),l}),o()(),n(12,"div")(13,"label",7),s(14,"Upload ID Document"),o(),n(15,"input",9),b("change",function(l){return e.onFileSelected(l)}),o()(),n(16,"button",10),b("click",function(){return e.submit()}),s(17),o()()()),r&2){let a,l,u;m(3),_(((a=e.user())==null?null:a.verificationStatus)==="pending"?3:((a=e.user())==null?null:a.verificationStatus)==="rejected"?4:(a=e.user())!=null&&a.isVerified?5:6),m(8),C("ngModel",e.nationalId),m(4),g("disabled",e.loading()||((l=e.user())==null?null:l.verificationStatus)==="pending"||((l=e.user())==null?null:l.isVerified)),m(),g("disabled",e.loading()||!e.nationalId||!e.documentUrl||((u=e.user())==null?null:u.verificationStatus)==="pending"||((u=e.user())==null?null:u.isVerified)),m(),V(" ",e.loading()?"Uploading...":"Submit for Verification"," ")}},dependencies:[w,j,M,T,k],encapsulation:2})}};function ne(i,t){return console.log("Checking verification for user:",i),console.log("User isVerified status (inside checkVerification):",i?.isVerified),i?.isVerified?!0:(t.create({zTitle:"Identity Verification Required",zDescription:"Please verify your ID to access this feature.",zContent:p,zWidth:"500px",zHideFooter:!0}),!1)}export{ne as a};
