import{a as te}from"./chunk-SX7D23K2.js";import{b as Q,d as ee}from"./chunk-BTBIWTRM.js";import"./chunk-YGBCOKBM.js";import"./chunk-2YIDOPGG.js";import"./chunk-2DHYFB3B.js";import{B as W,G as X,S as Y,X as Z,aa as q,lb as J,mb as K,w as j,x as G}from"./chunk-XQKT32VU.js";import{c as F,e as z,f as $}from"./chunk-GEE437AJ.js";import{c as U}from"./chunk-CADW372H.js";import"./chunk-EZWRTDAZ.js";import{a as H,b as L}from"./chunk-5FFKEXUF.js";import{j as k,p as P,s as V}from"./chunk-OAPWU2O3.js";import{Ab as y,Ac as c,Bc as O,Db as A,Eb as T,Fb as u,Gb as o,Hb as a,Ib as g,Pb as I,Ub as f,V as S,Wa as n,Wb as p,_ as b,da as _,ea as v,ic as l,kb as M,kc as s,lc as w,pa as h,t as E,vc as N,wc as B,zb as D,zc as d}from"./chunk-565OUHKP.js";var R=class i{constructor(){this.http=b(L);this.apiUrl=`${$.apiUrl}/moderation`}getReports(t={}){let e=new H;return Object.keys(t).forEach(r=>{t[r]!==null&&t[r]!==void 0&&(e=e.append(r,t[r]))}),this.http.get(this.apiUrl,{params:e}).pipe(E(r=>r))}resolveReport(t,e){return this.http.put(`${this.apiUrl}/${t}/resolve`,e)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})}};var oe=i=>({count:i}),le=(i,t)=>({"bg-white text-gray-900 shadow-sm":i,"text-gray-500 hover:text-gray-700":t}),se=(i,t)=>t.value,de=(i,t)=>t._id;function pe(i,t){if(i&1){let e=I();o(0,"button",9),f("click",function(){let m=_(e).$implicit,x=p();return v(x.setTab(m.value))}),l(1),d(2,"translate"),a()}if(i&2){let e=t.$implicit,r=p();u("ngClass",B(4,le,r.currentTab()===e.value,r.currentTab()!==e.value)),n(),s(" ",c(2,2,e.label)," ")}}function ce(i,t){i&1&&(o(0,"div",7)(1,"div",10),g(2,"div",11)(3,"div",11),a()())}function me(i,t){if(i&1&&(o(0,"div",12),g(1,"lucide-icon",13),o(2,"p",14),l(3),d(4,"translate"),a(),o(5,"p",15),l(6),d(7,"translate"),a()()),i&2){let e=p(2);n(),u("img",e.icons.CheckCircle),n(2),s(" ",c(4,3,"DASHBOARD.ADMIN.MODERATION.NO_REPORTS")," "),n(3),s(" ",c(7,5,"DASHBOARD.ADMIN.MODERATION.NO_REPORTS_SUBTITLE")," ")}}function ue(i,t){if(i&1){let e=I();o(0,"div",29)(1,"button",30),f("click",function(){_(e);let m=p().$implicit,x=p(3);return v(x.onReview(m))}),g(2,"lucide-icon",31),l(3),d(4,"translate"),a(),g(5,"div",18),o(6,"button",32),f("click",function(){_(e);let m=p().$implicit,x=p(3);return v(x.onDismiss(m._id))}),g(7,"lucide-icon",31),l(8),d(9,"translate"),a(),o(10,"button",33),f("click",function(){_(e);let m=p().$implicit,x=p(3);return v(x.onResolve(m))}),g(11,"lucide-icon",31),l(12),d(13,"translate"),a()()}if(i&2){let e=p(4);n(2),u("img",e.icons.Eye),n(),s(" ",c(4,6,"DASHBOARD.ADMIN.MODERATION.REVIEW")," "),n(4),u("img",e.icons.XCircle),n(),s(" ",c(9,8,"DASHBOARD.ADMIN.MODERATION.DISMISS")," "),n(3),u("img",e.icons.CheckCircle),n(),s(" ",c(13,10,"DASHBOARD.ADMIN.MODERATION.RESOLVE")," ")}}function ge(i,t){if(i&1&&(o(0,"ui-card",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"h3",20),l(5),a(),o(6,"span",21),g(7,"lucide-icon",22),l(8),d(9,"translate"),a(),o(10,"span",23),l(11),d(12,"translate"),a()(),o(13,"div",24)(14,"p",25)(15,"span",26),l(16),d(17,"translate"),a(),l(18),a(),o(19,"p",27),l(20),d(21,"translate"),o(22,"span",28),l(23),a(),l(24),d(25,"translate"),o(26,"span",28),l(27),d(28,"date"),a()()()()(),D(29,ue,14,12,"div",29),a()),i&2){let e=t.$implicit,r=p(3);n(5),s(" ",r.getItemName(e)," "),n(2),u("img",r.icons.Flag),n(),s(" ",c(9,11,e.targetType)," "),n(3),s(" ",c(12,13,e.status)," "),n(5),s("",c(17,15,"DASHBOARD.ADMIN.MODERATION.REASON"),":"),n(2),s(" ",e.reason," "),n(2),s(" ",c(21,17,"DASHBOARD.ADMIN.MODERATION.REPORTED_BY")," "),n(3),s(" ",e.reporterId.name||"Anonymous"," "),n(),s(" ",c(25,19,"DASHBOARD.ADMIN.MODERATION.ON")," "),n(3),s(" ",O(28,21,e.createdAt,"medium")," "),n(2),y(r.currentTab()==="pending"?29:-1)}}function xe(i,t){if(i&1&&A(0,ge,30,24,"ui-card",16,de),i&2){let e=p(2);T(e.reports())}}function _e(i,t){if(i&1&&D(0,me,8,7,"div",12)(1,xe,2,0),i&2){let e=p();y(e.reports().length===0?0:1)}}function ve(i,t){if(i&1){let e=I();o(0,"div",8)(1,"span",34),l(2),d(3,"translate"),a(),o(4,"div",35)(5,"button",36),f("click",function(){_(e);let m=p();return v(m.prevPage())}),g(6,"lucide-icon",31),l(7),d(8,"translate"),a(),o(9,"button",36),f("click",function(){_(e);let m=p();return v(m.nextPage())}),l(10),d(11,"translate"),g(12,"lucide-icon",31),a()()()}if(i&2){let e=p();n(2),w(" ",c(3,8,"DASHBOARD.GENERAL.PAGE")," ",e.currentPage()," "),n(3),u("disabled",e.currentPage()===1),n(),u("img",e.icons.ChevronLeft),n(),s(" ",c(8,10,"DASHBOARD.GENERAL.PREVIOUS")," "),n(2),u("disabled",e.reports().length<e.limit),n(),s(" ",c(11,12,"DASHBOARD.GENERAL.NEXT")," "),n(2),u("img",e.icons.ChevronRight)}}var ie=class i{constructor(){this.moderationService=b(R);this.router=b(U);this.dialogService=b(ee);this.reports=h([]);this.loading=h(!1);this.totalCount=h(0);this.currentTab=h("pending");this.currentPage=h(1);this.limit=10;this.tabs=[{label:"DASHBOARD.ADMIN.MODERATION.PENDING",value:"pending"},{label:"DASHBOARD.ADMIN.MODERATION.RESOLVED",value:"resolved"},{label:"DASHBOARD.ADMIN.MODERATION.DISMISSED",value:"dismissed"}];this.icons={Flag:Z,Eye:Y,CheckCircle:W,XCircle:X,ChevronLeft:j,ChevronRight:G,Filter:q}}ngOnInit(){this.loadReports()}loadReports(){this.loading.set(!0);let t={page:this.currentPage(),limit:this.limit,status:this.currentTab(),sort:"-createdAt"};this.moderationService.getReports(t).subscribe({next:e=>{this.reports.set(e.data||[]),this.totalCount.set(e.count||0),this.loading.set(!1)},error:()=>this.loading.set(!1)})}setTab(t){this.currentTab.set(t),this.currentPage.set(1),this.loadReports()}nextPage(){this.reports().length===this.limit&&(this.currentPage.update(t=>t+1),this.loadReports())}prevPage(){this.currentPage()>1&&(this.currentPage.update(t=>t-1),this.loadReports())}onDismiss(t){this.dialogService.create({zTitle:"Dismiss Report?",zDescription:"Are you sure you want to dismiss this report? The content will remain visible on the platform.",zOkText:"Yes, Dismiss",zCancelText:"Cancel",zWidth:"400px",zOnOk:()=>{this.moderationService.resolveReport(t,{status:"dismissed"}).subscribe({next:()=>{this.reports.update(e=>e.filter(r=>r._id!==t)),this.totalCount.update(e=>e-1)},error:e=>console.error("Dismiss failed",e)})}})}onResolve(t){let e="delete";t.targetType.toLowerCase()==="user"?e="ban":e="delete";let m=e==="ban"?"Ban User?":"Delete Content?",x=e==="ban"?"This will ban the user and restrict their access. This action cannot be easily undone.":"This will permanently remove the content from the platform. Are you sure?";this.dialogService.create({zTitle:m,zDescription:x,zOkText:e==="ban"?"Ban User":"Delete Content",zCancelText:"Cancel",zWidth:"400px",zOnOk:()=>{let ne={status:"resolved",action:e,adminNotes:`Resolved by admin: ${e} action taken.`};this.moderationService.resolveReport(t._id,ne).subscribe({next:()=>{this.reports.update(C=>C.filter(re=>re._id!==t._id)),this.totalCount.update(C=>C-1)},error:C=>console.error("Resolve failed",C)})}})}onReview(t){if(!t.targetId)return;let e=t.targetType.toLowerCase();switch(e){case"user":this.router.navigate(["/dashboard/admin/users"]);break;case"challenge":case"submission":this.router.navigate(["/dashboard/admin/challenges"]);break;default:console.warn("Unknown target type:",e)}}getItemName(t){if(!t.targetId)return"Deleted Content";let e=t.targetType.toLowerCase();return e==="user"?t.targetId.name||"Unknown User":e==="challenge"?t.targetId.title||"Untitled Challenge":e==="submission"?"Submission Content":"Unknown Item"}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=M({type:i,selectors:[["app-admin-moderation"]],decls:16,vars:11,consts:[[1,"space-y-6","animate-in","fade-in","slide-in-from-bottom-4","duration-500"],[1,"flex","flex-col","md:flex-row","md:items-center","justify-between","gap-4"],[1,"text-2xl","font-bold","mb-2","text-gray-900"],[1,"text-gray-600"],[1,"flex","p-1","bg-gray-100/50","rounded-lg"],[1,"px-4","py-2","rounded-md","transition-all","font-medium","text-sm",3,"ngClass"],[1,"space-y-4","min-h-100"],[1,"p-12","text-center"],[1,"flex","items-center","justify-between","border-t","border-gray-200","pt-4"],[1,"px-4","py-2","rounded-md","transition-all","font-medium","text-sm",3,"click","ngClass"],[1,"animate-pulse","space-y-4"],[1,"h-32","bg-gray-100","rounded-2xl","w-full"],[1,"p-16","text-center","border","border-dashed","border-gray-200","rounded-2xl","bg-white"],[1,"w-12","h-12","text-green-500","mx-auto","mb-3",3,"img"],[1,"text-gray-900","font-medium"],[1,"text-gray-500","text-sm"],[1,"mb-6"],[1,"flex","flex-col","md:flex-row","items-start","justify-between","gap-4","mb-6"],[1,"flex-1"],[1,"flex","flex-wrap","items-center","gap-3","mb-2"],[1,"text-lg","font-bold","text-gray-900"],[1,"px-3","py-1","bg-gray-100","rounded-full","text-xs","font-medium","text-gray-600","capitalize","flex","items-center","gap-1"],[1,"w-3","h-3",3,"img"],[1,"px-3","py-1","bg-orange-50","text-orange-700","border","border-orange-100","rounded-full","text-xs","font-medium"],[1,"bg-gray-50","p-3","rounded-lg","border","border-gray-100","mt-6"],[1,"text-sm","text-gray-800"],[1,"font-medium","text-gray-500"],[1,"text-xs","text-gray-500","mt-2","flex","items-center","gap-1"],[1,"font-medium","text-gray-700"],[1,"flex","flex-wrap","gap-3","border-t","border-gray-100","pt-4"],[1,"flex","items-center","gap-2","px-4","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition-all","text-sm","font-medium",3,"click"],[1,"w-4","h-4",3,"img"],[1,"flex","items-center","gap-2","px-4","py-2","bg-white","border","border-gray-200","text-gray-700","rounded-lg","hover:bg-gray-50","transition-all","text-sm","font-medium",3,"click"],[1,"flex","items-center","gap-2","px-4","py-2","bg-red-50","text-red-700","border","border-red-100","rounded-lg","hover:bg-red-100","transition-all","text-sm","font-medium",3,"click"],[1,"text-sm","text-gray-500"],[1,"flex","gap-2"],[1,"flex","items-center","gap-1","px-3","py-1.5","rounded-lg","border","border-gray-200","bg-white","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","text-sm","text-gray-600",3,"click","disabled"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),l(4),d(5,"translate"),a(),o(6,"p",3),l(7),d(8,"translate"),a()(),o(9,"div",4),A(10,pe,3,7,"button",5,se),a()(),o(12,"div",6),D(13,ce,4,0,"div",7)(14,_e,2,1),a(),D(15,ve,13,14,"div",8),a()),e&2&&(n(4),s(" ",c(5,4,"DASHBOARD.ADMIN.MODERATION.TITLE")," "),n(3),s(" ",O(8,6,"DASHBOARD.ADMIN.MODERATION.SUBTITLE",N(9,oe,r.totalCount()))," "),n(3),T(r.tabs),n(3),y(r.loading()?13:14),n(2),y(!r.loading()&&r.reports().length>0?15:-1))},dependencies:[V,k,K,J,Q,te,z,P,F],encapsulation:2})}};export{ie as Moderation};
